all:
  vars:
    ansible_ssh_become: yes
    ansible_become: yes
    ansible_ssh_user: ansible_user
    ansible_ssh_private_key_file: keys/ansible_user
    ansible_connection: ssh
    ansible_become_method: sudo
    envfile: staging.env
    envfile_common: common.staging.env
    envfile_local: .env.stage
    node_env: production
    docker_version: 20.10.6
    docker_compose: yes
    # cleversite_web_public:
      # deploy_src: "{{ app_src }}"
      # prefix: /var/www/
      # base_path: /app/web-public
      # namespace: "{{ app_namespace.replace('.','') if app_namespace is defined else '' }}"
      # data_path: "/var/www/app/web-public-data"
      # active_release_path: "/cleversite-web-public"
      # remove_dirs:
      #   - upload
      #   - docker
      #   - .git
      # external_data_path: /var/www/app/web-public-data
      # external_data:
      #   - src: "download"
      #     dest: download
      #   - src: "exchange"
      #     dest: exchange
      #   - src: "exchange_archive"
      #     dest: exchange_archive
      #   - src: "pays"
      #     dest: pays
      #   - src: "ipts"
      #     dest: callback/wav
      #   - src: "upload"
      #     dest: upload

  children:
    cleversite_codes:
      vars:
        git_user: deploy_user
        git_token: Xy2iDzXMdWxef8Hx2Tdz
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/codes.git"
        app_basepath: /var/www/app/cleversite-codes
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: /var/www/codes
        app_backup_release_path: "{{app_basepath}}/backup"
        app_release_name: deploy-test
        app_release_commit: master
        app_domain: codes.cleversite.staging.local
      hosts:
        codes-staging:
          ansible_ssh_host: cs-test-lb01.servicecloud.info

    cleversite_static:
      vars:
        git_user: deploy_user
        git_token: 9Wbrx9mXk5msJ2Ys7zMx
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/static.git"
        app_basepath: /var/www/app/cleversite-static
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: /var/www/static
        app_backup_release_path: "{{app_basepath}}/backup"
        app_release_name: deploy-test
        app_release_commit: master
        app_domain: static.cleversite.staging.local
      hosts:
        static-staging:
          ansible_ssh_host: cs-test-lb01.servicecloud.info

    cleversite_ws:
      vars:
        git_user: deploy_user
        git_token: Sx9sddM65H9QTimfnnKW
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/ws.git"
        app_basepath: /var/www/app/cleversite-ws
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: /var/www/ws
        app_backup_release_path: "{{app_basepath}}/backup"
        app_release_name: deploy-test
        app_release_commit: master
        app_domain: ws.cleversite.staging.local
      hosts:
        ws-staging:
          ansible_ssh_host: cs-test-lb01.servicecloud.info
          ws_balancer: True
          ws_worker: True
          ws_ports:
            - 6012
            - 6013
            - 6014
            - 6015
            - 6016
            - 6017
            - 6018
            - 6019
            - 6020
            - 6021
            - 6022
            - 6023
            - 6024
          


    cleversite_pult:
      vars:
        git_user: deploy_user
        git_token: d2xvHQfs2x8jtyJADeML
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/pult.git"
        app_basepath: /var/www/app/cleversite-pult
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: /var/www/pult
        app_backup_release_path: "{{app_basepath}}/backup"
        app_release_name: master-12345
        app_release_commit: master
        app_domain: pult.cleversite.staging.local
      hosts:
        pult-staging:
          ansible_ssh_host: cs-test-lb01.servicecloud.info

    cleversite_web:
      vars:
        phpfpm_fcgi_socket: /opt/cleversite-services/php-fpm/www.sock
        git_user: deploy_user
        git_token: f-BLVAb9Dun5pkAVQiSj
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/web.git"
        app_basepath: /var/www/app/web
        app_release_name: manual-deploy
        app_release_commit: master
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: "/var/www/cleversite"
        app_backup_release_path: "{{app_basepath}}/backup"
        app_domain: cleversite.staging.local
        app_data_path: "{{app_basepath}}/data"
        app_external_data:
          - src: "{{app_data_path}}/download"
            dest: download
          - src: "{{app_data_path}}/exchange"
            dest: exchange
          - src: "{{app_data_path}}/exchange_archive"
            dest: exchange_archive
          - src: "{{app_data_path}}/pays"
            dest: pays
          - src: "{{app_data_path}}/users"
            dest: cleversite/user
          - src: "{{app_data_path}}/ipts"
            dest: callback/wav
          - src: "{{app_data_path}}/upload"
            dest: upload
        app_template_dest: "{{app_path}}/bitrix/templates/cleversite_dec2020"
        app_current_env_path: "{{app_basepath}}/.env"
        custom_crontab_files: "/var/spool/cron"
        crontab_source: .crontabs/staging.yaml
        webtemplate:
          app_basepath: /var/www/app/web-template
          app_path: "/var/www/app/web-template/{{app_release_name}}"
          app_current_path: "/var/www/app/web-template/current"

      hosts:
        cs-test-lb01.servicecloud.info: {}

    cleversite_web_public:
      vars:
        phpfpm_fcgi_socket: /opt/cleversite-services/php-fpm/www.sock
        envfile_common: common-web-public.staging.env
        # git_user: deploy_user
        # git_token: zAyvusLvrrJv_vPy94xN
        # app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/public-site.git"
        # app_basepath: /var/www/app/web-public
        # app_release_name: manual-deploy
        # app_release_commit: master
        # app_path: "{{app_basepath}}/{{app_release_name}}"
        # app_current_release_path: "/var/www/cleversite-web-public"
        # app_backup_release_path: "{{app_basepath}}/backup"
        # app_domain: cleversite.staging.local
        # app_data_path: "/var/www/app/web-public-data"
        # app_external_data:
        #   - src: "{{app_data_path}}/download"
        #     dest: download
        #   - src: "{{app_data_path}}/exchange"
        #     dest: exchange
        #   - src: "{{app_data_path}}/exchange_archive"
        #     dest: exchange_archive
        #   - src: "{{app_data_path}}/pays"
        #     dest: pays
        #   - src: "{{app_data_path}}/ipts"
        #     dest: callback/wav
        #   - src: "{{app_data_path}}/upload"
        #     dest: upload
        # app_current_env_path: "{{app_basepath}}/.env"

      hosts:
        web-public-staging.servicecloud.info:
          ansible_ssh_host: cs-test-lb01.servicecloud.info
          ansible_host: cs-test-lb01.servicecloud.info
    cleversite_api:
      vars:
        git_user: deploy_user
        git_token: 31UtXyw_S-So2up7Q-Uq
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/api.git"
        app_basepath: /var/www/app/api_cleversite
        app_release_name: master-12345
        app_release_commit: master
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: "/var/www/api-cleversite"
        app_backup_release_path: "{{app_basepath}}/backup"
        app_domain: api.cleversite.staging.local
      hosts:
        webapi-cs-test-lb01.servicecloud.info:
          ansible_ssh_host: cs-test-lb01.servicecloud.info
