all:
  vars:
    ansible_ssh_become: yes
    ansible_become: yes
    ansible_ssh_user: ansible_user
    ansible_ssh_private_key_file: keys/ansible_user
    ansible_connection: ssh
    ansible_become_method: sudo
    envfile: prod.env
    envfile_common: common.prod.env
    envfile_local: .env.prod
    node_env: production
  children:
    cleversite_call:
      vars:
        phpfpm_fcgi_socket: /var/run/php-fpm/php-fpm-www.sock
      hosts:
        cs-call01.servicecloud.info: {} 
    cleversite_web:
      vars:
        git_user: deploy_user
        git_token: f-BLVAb9Dun5pkAVQiSj
        phpfpm_fcgi_socket: /var/run/php-fpm/php-fpm-www.sock
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/web.git"
        app_basepath: /var/www/app/web
        app_release_name: manual-deploy
        app_release_commit: master
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: "/var/www/cleversite"
        app_backup_release_path: "{{app_basepath}}/backup"
        app_domain: cleversite.ru
        app_data_path: "/var/www/app/app-data"         
        app_external_data:
          - src: "{{app_data_path}}/download"
            dest: download
          - src: "{{app_data_path}}/exchange"
            dest: exchange
          - src: "{{app_data_path}}/exchange_archive"
            dest: exchange_archive
          - src: /var/www/pays
            dest: pays
          - src: /var/www/user
            dest: cleversite/user
          - src: /var/www/ipts
            dest: callback/wav
          - src: "{{app_data_path}}/upload"
            dest: upload        
        app_template_dest: "{{app_path}}/bitrix/templates/cleversite_dec2020"
        app_current_env_path: "{{app_basepath}}/.env"
        custom_crontab_files: "/var/spool/cron"
        crontab_source: .crontabs/prod.yaml
        webtemplate:
          app_basepath: /var/www/app/web-template          
          app_path: "/var/www/app/web-template/{{app_release_name}}"
          app_current_path: "/var/www/app/web-template/current"
          
      hosts:
        cs-web01.servicecloud.info: {}
    cleversite_web_public:
      vars:
        phpfpm_fcgi_socket: /var/run/php-fpm/php-fpm-www.sock
        git_user: deploy_user
        git_token: zAyvusLvrrJv_vPy94xN
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/public-site.git"
        app_basepath: /var/www/app/web-public        
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: "/var/www/cleversite-web-public"
        app_backup_release_path: "{{app_basepath}}/backup"
        app_domain: cleversite.testing.local
        app_data_path: "/var/www/app/app-data-public"        
        app_external_data:
          - src: "{{app_data_path}}/download"
            dest: download
          - src: "{{app_data_path}}/exchange"
            dest: exchange
          - src: "{{app_data_path}}/exchange_archive"
            dest: exchange_archive
          - src: "{{app_data_path}}/pays"
            dest: pays
          #- src: "{{app_data_path}}/users"
          #  dest: cleversite/user
          #- src: "{{app_data_path}}/ipts"
          #  dest: callback/wav
          - src: "{{app_data_path}}/upload"
            dest: upload                
        app_current_env_path: "{{app_basepath}}/.env"
        envfile_common: common-web-public.prod.env
      hosts:
        cs-web02.servicecloud.info: {}        


    cleversite_ws:
      vars:
        git_user: deploy_user
        git_token: Sx9sddM65H9QTimfnnKW
        app_git_repo: "https://{{git_user}}:{{git_token}}@gitlab.servicecloud.info/cleversite/ws.git"
        app_basepath: /var/www/app/cleversite-ws
        app_path: "{{app_basepath}}/{{app_release_name}}"
        app_current_release_path: /var/www/ws
        app_backup_release_path: "{{app_basepath}}/backup"
        app_release_name: deploy-test
        app_release_commit: master
        app_domain: ws.cleversite.staging.local
      hosts:
        sc-nodejs02.servicecloud.info:
          ws_balancer: False
          ws_worker: True
          ws_ports:
            - 6002
            - 6003
            - 6004
            - 6005
            - 6006
            - 6007
            - 6008
            - 6009
            - 6010
            - 6011
            - 6012
            - 6013
            - 6014
            - 6015
            - 6016
            - 6017
            - 6018
            - 6019
            - 6020
            - 6021
            - 6022
            - 6023
        sc-nodejs03.servicecloud.info:
          ws_balancer: False
          ws_worker: True
          ws_ports:
            - 6032
            - 6033
            - 6034
            - 6035
            - 6036
            - 6037
            - 6038
            - 6039
            - 6040
            - 6041
            - 6042
            - 6043
            - 6044
            - 6045
            - 6046
            - 6047
            - 6048
            - 6049
            - 6050
            - 6051
            - 6052
            - 6053
